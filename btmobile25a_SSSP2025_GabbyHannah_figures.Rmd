---
title: "btmobile25a main analyses"
author: "Anonymized for peer review (NC)"
reviewer: "Anonymized for peer review (JT)"
output: word_document
editor_options: 
  chunk_output_type: console
---

This code conducts the main analyses and produces the main figure for the Stage 1 Registered Report

# Setup
```{r}
# specify data directory
data_dir <- Sys.getenv("data_dir")

# source setup file
source('setup.R')
```

# Open processed data
```{r}
DF <- 
  readRDS(
    file.path(data_dir,
              'combined',
              'DF.full.combined.processed.Rds')
          )

# compute inverse frequency weights
DF <- DF %>%
  count(authors.n, name = "n_authors") %>%
  mutate(inv_freq_weight = 1 / n_authors) %>%
  right_join(DF, by = "authors.n") %>%
  mutate(w = inv_freq_weight / mean(inv_freq_weight, na.rm = TRUE))
```

# Create Figures


Specify final models
```{r}
# speed
speed.m <-
  lm(speed.per ~ authors.n + 
         I(authors.n ^ 2),
       weight = w,
       data = DF)


# scholarly citations
schol.m <-
  lm(citation.per ~ log(authors.n),
       weight = w,
       data = DF)

# news citations
news.m <-
  lm(news.per ~ authors.n +
         I(authors.n ^ 2),
       weight = w,
       data = DF)


# policy citations
policy.m <-
  lm(policy.per ~ authors.n + I(authors.n ^ 2),
       weight = w,
       data = DF)

```

Extract predicted values
```{r}

# Predicted speed values
speed <- 
  predict_response(speed.m,
                   terms= "authors.n [all]") %>% 
  as.data.frame() %>% 
  mutate(outcome = 'response speed') %>% 
  select(x, predicted, outcome)

# predicted citation values
schol <- 
  predict_response(schol.m,
                   terms= "authors.n [all]") %>% 
  as.data.frame() %>% 
  mutate(outcome = 'scholarly article citations') %>% 
  select(x, predicted, outcome)

# Predicted news mention values
news <- 
  predict_response(news.m,
                   terms= "authors.n [all]") %>% 
  as.data.frame() %>% 
  mutate(outcome = 'news citations') %>% 
  select(x, predicted, outcome)

# predicted policy making values
poli <-
  predict_response(policy.m,
                   terms= "authors.n [all]") %>% 
  as.data.frame() %>% 
  mutate(outcome = 'policy document citations') %>% 
  select(x, predicted, outcome)

```

Plot
```{r}
# Scholarly citation plot
ggplot(data = schol,
       aes(x = x,
           y = predicted,
           label = outcome)) +
  
  # citation
  geom_textsmooth(
    data = schol,
    method = 'lm',
    formula = y ~ log(x),
    alpha = .7,
    color = '#CC79A7') +
  
  labs(x = '# of co-authors',
       y = "average percentile") +
  
  theme(panel.background = element_rect(fill = "#F5F5F5"))


# News plot
ggplot(data = news,
       aes(x = x,
           y = predicted,
           label = outcome)) +
  geom_textsmooth(
    data = news,
    method = 'lm',
    formula = y ~ x + I(x^2),
    alpha = .7,
    color = '#0072B2') +
  labs(x = '# of co-authors',
       y = "average percentile") +
  
  theme(panel.background = element_rect(fill = "#F5F5F5"))


# Policy plot
ggplot(data = poli,
       aes(x = x,
           y = predicted,
           label = outcome)) +
  geom_textsmooth(
    data = poli,
    method = 'lm',
    formula = y ~ x + I(x^2),
    alpha = .7,
    color = '#D55E00') +
  labs(x = '# of co-authors',
       y = "average percentile") +
  
  theme(panel.background = element_rect(fill = "#F5F5F5"))
  
  # speed
ggplot(data = speed,
       aes(x = x,
           y = predicted,
           label = outcome)) +
  geom_textsmooth(
    data = speed,
    method = 'lm',
    formula = y ~ x + I(x^2),
    alpha = .7,
    color = '#009E73') +
  
  labs(x = '# of co-authors',
       y = "average percentile") +
  
  theme(panel.background = element_rect(fill = "#F5F5F5"))

```
